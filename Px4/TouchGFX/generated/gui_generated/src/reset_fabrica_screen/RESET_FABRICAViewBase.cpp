/*********************************************************************************/
/********** THIS FILE IS GENERATED BY TOUCHGFX DESIGNER, DO NOT MODIFY ***********/
/*********************************************************************************/
#include <gui_generated/reset_fabrica_screen/RESET_FABRICAViewBase.hpp>
#include <touchgfx/Color.hpp>
#include <texts/TextKeysAndLanguages.hpp>
#include "BitmapDatabase.hpp"

RESET_FABRICAViewBase::RESET_FABRICAViewBase() :
    buttonCallback(this, &RESET_FABRICAViewBase::buttonCallbackHandler)
{

    __background.setPosition(0, 0, 480, 272);
    __background.setColor(touchgfx::Color::getColorFromRGB(0, 0, 0));

    boxFundo.setPosition(0, 0, 480, 272);
    boxFundo.setColor(touchgfx::Color::getColorFromRGB(255, 255, 255));

    textAreaLabel.setXY(86, 30);
    textAreaLabel.setColor(touchgfx::Color::getColorFromRGB(0, 0, 0));
    textAreaLabel.setLinespacing(0);
    textAreaLabel.setTypedText(touchgfx::TypedText(T_SINGLEUSEID3791));

    buttonConfiguracao.setXY(8, 102);
    buttonConfiguracao.setBitmaps(touchgfx::Bitmap(BITMAP_VOLTAR2_ID), touchgfx::Bitmap(BITMAP_VOLTAR2_ID));
    buttonConfiguracao.setAction(buttonCallback);

    buttonWithLabelResetFabrica.setXY(177, 196);
    buttonWithLabelResetFabrica.setBitmaps(touchgfx::Bitmap(BITMAP_RESETOFF_ID), touchgfx::Bitmap(BITMAP_RESETON_ID));
    buttonWithLabelResetFabrica.setLabelText(touchgfx::TypedText(T_SINGLEUSEID5433));
    buttonWithLabelResetFabrica.setLabelColor(touchgfx::Color::getColorFromRGB(0, 0, 0));
    buttonWithLabelResetFabrica.setLabelColorPressed(touchgfx::Color::getColorFromRGB(0, 0, 0));
    buttonWithLabelResetFabrica.setAction(buttonCallback);

    background1.setXY(0, 0);

    add(__background);
    add(boxFundo);
    add(textAreaLabel);
    add(buttonConfiguracao);
    add(buttonWithLabelResetFabrica);
    add(background1);
}

void RESET_FABRICAViewBase::setupScreen()
{
    background1.initialize();
    //ScreenTransitionBegins
    //When screen transition begins execute C++ code
    //Execute C++ code
    Clear();
    
    WriteModbus485(10331, 1);
    
    WriteModbus485(10324, 1);
    WriteModbus485(10255, 1);
    WriteModbus485(10256, 1);
    WriteModbus485(10258, 1);
    WriteModbus485(10270, 1);
    WriteModbus485(10279, 1);
    WriteModbus485(10294, 1);
    WriteModbus485(10295, 1);
    
    ReadWriteModbus485(10265, REPEAT);
    
    Wait(100);

}

//Called when the screen transition ends
void RESET_FABRICAViewBase::afterTransition()
{
    //ScreenTransitionEnds
    //When screen transition ends execute C++ code
    //Execute C++ code
    UpdateModbus485(10331, 1, _DOUBLE_);
    SoundBuzzerOn(25);
}

void RESET_FABRICAViewBase::tearDownScreen()
{
    //TearDownScreen
    //When tearDownScreen is called execute C++ code
    //Execute C++ code
    UpdateModbus485(10331, 0, _DOUBLE_);
    Wait(50);
    
    Clear();
}

void RESET_FABRICAViewBase::buttonCallbackHandler(const touchgfx::AbstractButton& src)
{
    if (&src == &buttonConfiguracao)
    {
        //Configuracao
        //When buttonConfiguracao clicked change screen to Configuracao
        //Go to Configuracao with no screen transition
        application().gotoConfiguracaoScreenNoTransition();
    }
    else if (&src == &buttonWithLabelResetFabrica)
    {
        //ResetFabrica
        //When buttonWithLabelResetFabrica clicked call reset on background1
        //Call reset
        background1.reset();

        //ResetMemory
        //When ResetFabrica completed execute C++ code
        //Execute C++ code
        ResetDataMemory();
        WriteMemory(54, W_HAW8214, 20);
        WriteMemory(57, W_HAW8235, 20);
        SoundBuzzerOn(25);
    }
}
